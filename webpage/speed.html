<!doctype html>
<html>
    <head>
        <title>current stats</title>


<script type="text/javascript" src="//pubnub.github.io/eon/v/eon/1.0.0/eon.js"></script>
       
    </head>
    <body>
    
<table style="margin-left: auto; margin-right: auto;" cellspacing="2" cellpadding="2">
<tbody>
<tr>
<td><div style='width: 150px;'>00-30-4f-27-b5-c3</div></td>
<td><div style='width: 150px;'>&#11014;<span id="00-30-4f-27-b5-c3_up" style="color:red;"></span></div></td>
<td><div style='width: 150px;'>&#11015; <span id="00-30-4f-27-b5-c3_down" style="color:blue;"></span></div></td>
</tr>
</tbody>
</table>
   


<p><b>4c-cc-6a-4f-ef-67 Up:</b> <span id="4c-cc-6a-4f-ef-67_up"></span></p>
<p><b>4c-cc-6a-4f-ef-67 Down:</b> <span id="4c-cc-6a-4f-ef-67_down"></span></p>


<div id="chart"></div>
<script>
  var pubnub = new PubNub({
    publishKey:   'demo', // replace with your own pub-key
    subscribeKey: 'demo' // replace with your own sub-key
  });

  eon.chart({
    pubnub: pubnub,
    channels: ["c3-spline"],
    generate: {
      bindto: '#chart',
      data: {
        labels: true
      }
    }
  });
</script>


<script>

	var xhttp = new XMLHttpRequest();

	var timer = setInterval(LoadData, 1000);


	xhttp.onreadystatechange = function ()
	{
		if (this.readyState == 4 && this.status == 200)
		{
			var json_obj = JSON.parse(this.responseText);
			for (var mac in json_obj)
			{
				if (json_obj.hasOwnProperty(mac))
				{
					var up_id = mac + "_up";
					var down_id = mac + "_down";

					var down_speed = json_obj[mac].speed["down"];
					var up_speed = json_obj[mac].speed["up"];
					
					document.getElementById(up_id).innerHTML = value2str(up_speed);
					document.getElementById(down_id).innerHTML = value2str(down_speed);
					
pubnub.publish({
    channel: 'c3-spline',
    message: {
      eon: {
        up_id: up_speed,
        down_id: down_speed
      }
    }
  });					
					
				}
			}

		}
	};

	function value2str(value)
	{
		unit = "";

		if (value >= 1024 * 1024 * 1024 * 1024 * 1024)
		{
			scale = 1024.0 * 1024.0 * 1024.0 * 1024.0 * 1024.0;
			unit = "Pb/s";
		}
		else if (value >= 1024 * 1024 * 1024 * 1024)
		{
			scale = 1024.0 * 1024.0 * 1024.0 * 1024.0;
			unit = "Tb/s";
		}
		else if (value >= 1024 * 1024 * 1024)
		{
			scale = 1024.0 * 1024.0 * 1024.0;
			unit = "Gb/s";
		}
		else if (value >= 1024 * 1024)
		{
			scale = 1024.0 * 1024.0;
			unit = "Mb/s";
		}
		else if (value >= 1024)
		{
			scale = 1024.0;
			unit = "Kb/s";
		}
		else
		{
			scale = 1.0;
			unit = "b/s";
		}

		value /= scale;

		return value.toFixed(2).replace(/\.?0*$/, '') + " " + unit;
	}

	function LoadData()
	{
		xhttp.open("GET", "/speed.json", true);
		xhttp.setRequestHeader("Access-Control-Allow-Origin", "*");
		xhttp.setRequestHeader("Access-Control-Allow-Headers", "Origin, X-Requested-With, Content-Type, Accept");
		xhttp.setRequestHeader("contentType", "application/json; charset=utf-8");
		xhttp.overrideMimeType("application/json");
		xhttp.send();
	}
</script>


    </body>
</html>

